# resample():é‡é‡‡æ ·

resample(rule,how=None,axis=0,fill_method=None,closed=None,label=None,convention='start',kind=None,loffset=None,base=0,on=None,level=None)

Parameters
----------
#label(æ ‡ç­¾)closed(é—­åˆ)ï¼š   https://blog.csdn.net/qq_15407209/article/details/85308687
label = 'left': å·¦æ ‡ç­¾ï¼Œæ˜¾ç¤ºåŒºé—´çš„å·¦è¾¹å€¼
closed = 'left' å·¦é—­åˆï¼ŒåŒºé—´ä¸ºå·¦é—­å³å¼€ï¼Œå³[a,b)

closed : {'right', 'left'}
        Which side of bin interval is closed. The default is â€˜leftâ€™ for all frequency offsets 
        except for â€˜Mâ€™, â€˜Aâ€™, â€˜Qâ€™, â€˜BMâ€™, â€˜BAâ€™, â€˜BQâ€™, and â€˜Wâ€™ which all have a default of â€˜rightâ€™.
label : {'right', 'left'}
        Which bin edge label to label bucket with. The default is â€˜leftâ€™ for all frequency offsets
        except for â€˜Mâ€™, â€˜Aâ€™, â€˜Qâ€™, â€˜BMâ€™, â€˜BAâ€™, â€˜BQâ€™, and â€˜Wâ€™ which all have a default of â€˜rightâ€™.

Example1(é™é‡‡æ ·):

1. é¦–å…ˆå…ˆæ¥åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—ï¼Œèµ·å§‹æ—¥æœŸæ˜¯2018/01/01ï¼Œä¸€å…±12å¤©ï¼Œæ¯å¤©å¯¹åº”çš„æ•°å€¼åˆ†åˆ«æ˜¯1åˆ°12ï¼š
rng = pd.date_range('20180101', periods=12)
ts = pd.Series(np.arange(1,13), index=rng)
print(ts)

#### Outputs ####
2018-01-01     1
2018-01-02     2
2018-01-03     3
2018-01-04     4
2018-01-05     5
2018-01-06     6
2018-01-07     7
2018-01-08     8
2018-01-09     9
2018-01-10    10
2018-01-11    11
2018-01-12    12
Freq: D, dtype: int32

2. ä¸‹é¢ä½¿ç”¨resampleæ–¹æ³•æ¥åšé™é‡‡æ ·å¤„ç†ï¼Œé¢‘ç‡æ˜¯5å¤©ï¼Œä¸Šé¢æåˆ°çš„ä¸¤ä¸ªå‚æ•°ï¼Œéƒ½ä½¿ç”¨é»˜è®¤å€¼ï¼š
ts_5d = ts.resample('5D').sum()  #closedé»˜è®¤çš„å€¼æ˜¯'left'ã€‚
print(ts_5d)

#### Outputs ####
2018-01-01    15
2018-01-06    40
2018-01-11    23
Freq: 5D, dtype: int32

å®é™…ä¸Šï¼Œè¿™ä¸‰ä¸ª5å¤©å°±æ˜¯ä¸‰ä¸ªåŒºé—´äº†ã€‚å’Œæ•°å­¦é‡ŒåŒºé—´çš„æ¦‚å¿µä¸€æ ·ï¼ŒåŒºé—´æœ‰å¼€å’Œé—­çš„æ¦‚å¿µã€‚åœ¨resampleä¸­ï¼ŒåŒºé—´çš„å¼€å’Œé—­ï¼Œå°±æ˜¯é€šè¿‡closedè¿™ä¸ªå‚æ•°æ¥æ§åˆ¶ã€‚ç”¨æ•°å­¦ç¬¦å·è¡¨ç¤ºçš„è¯:
closed = 'left' å·¦é—­å³å¼€
ä¸Šé¢çš„ä¸‰ä¸ª5å¤©å¯ä»¥ç”±ä»¥ä¸‹çš„ä¸‰ä¸ªå·¦é—­å³å¼€çš„åŒºé—´æ„æˆï¼š
åŒºé—´1ï¼š[1, 6)
åŒºé—´2: [6, 11)
åŒºé—´3ï¼š[11, 16) ä¾‹å­ä¸­ï¼Œæ—¶é—´åªåˆ°12å·ä¸ºæ­¢ï¼Œä½†æ˜¯è¿™é‡Œä¼šå¾€åè¡¥è¶³5å¤©

ç°åœ¨ï¼Œåœ¨è¿™ä¸‰ä¸ªåŒºé—´ä¸Šåšæ•°æ®èšåˆä¹Ÿå°±å¾ˆå¥½ç†è§£äº†ã€‚å¯¹äºåŒºé—´1è¿›è¡Œæ±‚å’Œï¼Œä¹Ÿå°±æ˜¯1ã€2ã€3ã€4ã€5è¿™5å¤©çš„å€¼æ±‚å’Œå³å¯ã€‚åŒºé—´2å’ŒåŒºé—´3ä¹Ÿæ˜¯åŒç†

3. é‚£å¦‚æœæŠŠclosedçš„å€¼æ”¹ä¸º'right'ï¼Œç»“æœæœ‰æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ
ts_5d_rightclosed = ts.resample('5D', closed='right').sum()  #default:label='left'
print(ts_5d_rightclosed)

#### Outputs ####
2017-12-27     1
2018-01-01    20
2018-01-06    45
2018-01-11    12
Freq: 5D, dtype: int32

æ€ä¹ˆä¼šè¿™æ ·ï¼Ÿä¸ºä»€ä¹ˆå˜æˆäº†å››ä¸ªåŒºé—´ï¼Ÿclosed=rightåˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ
åˆ«ç€æ€¥ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥çœ‹çœ‹ï¼Œè¿™å…¶ä¸­å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ã€‚åŸå§‹çš„æ—¶é—´åºåˆ—æ˜¯ä»18å¹´1æœˆ1å·åˆ°1æœˆ12å·ï¼Œä¸€å…±12å¤©ã€‚ä»¥5å¤©ä¸ºå•ä½é™é‡‡æ ·å¤„ç†åï¼Œå˜æˆäº†ä¸‰ä¸ª5å¤©ï¼Œåˆ†åˆ«æ˜¯ï¼š

ç¬¬ä¸€ä¸ª5å¤©ï¼š1-2-3-4-5-6
ç¬¬äºŒä¸ª5å¤©ï¼š6-7-8-9-10-11
ç¬¬ä¸‰ä¸ª5å¤©ï¼š12-13-14-15-16

closed = 'right' å·¦å¼€å³é—­
ä¸Šé¢çš„ä¸‰ä¸ª5å¤©å¯ä»¥ç”±ä»¥ä¸‹çš„å››ä¸ªå·¦å¼€å³é—­çš„åŒºé—´æ„æˆã€‚ğŸ–ğŸ–ğŸ–ğŸ–ğŸ–æ³¨æ„ï¼Œç”±äºç¬¬ä¸€ä¸ª5å¤©æ˜¯ä»1å·åˆ°6å·ï¼Œä½†ç”±äºæ˜¯å·¦å¼€åŒºé—´ï¼Œ1å·å°±è½ä¸åˆ°1åˆ°6å·çš„é‚£ä¸ªåŒºé—´ï¼Œæ‰€ä»¥è¦å¾€å‰è¡¥è¶³ï¼š

åŒºé—´1ï¼š(27, 1]
åŒºé—´2ï¼š(1, 6]
åŒºé—´3: (6, 11]
åŒºé—´4ï¼š(11, 16]

ç°åœ¨ï¼Œåœ¨è¿™å››ä¸ªåŒºé—´ä¸Šåšæ•°æ®èšåˆä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†äº†ï¼šå¯¹äºåŒºé—´1ï¼Œæ˜¯å¯¹28ï¼Œ29ï¼Œ30ï¼Œ31ï¼Œ1è¿™äº”å¤©çš„å€¼æ±‚å’Œï¼ˆè¿™é‡Œåªæœ‰1å·æ˜¯æœ‰å€¼çš„ï¼‰ï¼Œå…¶ä½™çš„åŒºé—´ä¹Ÿæ˜¯åŒç†ï¼Œä½†éœ€è¦æ³¨æ„æ˜¯å·¦å¼€å³é—­ã€‚

#################################
Default: label='left'

1. ä¸‹é¢åœ¨closed='right'çš„åŸºç¡€ä¸Šï¼Œå°†labelè®¾ç½®ä¸ºrightï¼š
ts_5d_rightclosed_rightlable = ts.resample('5D', closed='right', label='right').sum()
print(ts_5d_rightclosed_rightlable)

#### Outputs ####
2018-01-01     1
2018-01-06    20
2018-01-11    45
2018-01-16    12
Freq: 5D, dtype: int32

###################################
ffill():
s = pd.Series([1, 2, 3],index=pd.date_range('20180101', periods=3, freq='min'))
print(s)
>>>
2018-01-01 00:00:00    1
2018-01-01 00:01:00    2
2018-01-01 00:02:00    3
Freq: S, dtype: int64
---------------
data = s.resample('15s').ffill()
print(data)
2018-01-01 00:00:00    1
2018-01-01 00:00:15    1
2018-01-01 00:00:30    1
2018-01-01 00:00:45    1
2018-01-01 00:01:00    2
2018-01-01 00:01:15    2
2018-01-01 00:01:30    2
2018-01-01 00:01:45    2
2018-01-01 00:02:00    3
Freq: 15S, dtype: int64
----------------------
ğŸ–ğŸ–ğŸ–ğŸ–é™é‡‡æ ·
data1 = data.resample('13s').ffill()
print(data1)
>>>
2018-01-01 00:00:00    1
2018-01-01 00:00:13    1
2018-01-01 00:00:26    1
2018-01-01 00:00:39    1
2018-01-01 00:00:52    1
2018-01-01 00:01:05    2
2018-01-01 00:01:18    2
2018-01-01 00:01:31    2
2018-01-01 00:01:44    2
2018-01-01 00:01:57    2
Freq: 13S, dtype: int64
###################################
----------------------------------------
Exaple2(å‡é‡‡æ ·):

1. åˆ›å»ºä¸€ä¸ªæ—¶é—´åºåˆ—ï¼Œèµ·å§‹æ—¥æœŸæ˜¯2018/01/01ï¼Œä¸€å…±2å¤©ï¼Œæ¯å¤©å¯¹åº”çš„æ•°å€¼åˆ†åˆ«æ˜¯1åˆ°2:
rng = pd.date_range('20180101', periods=2)
ts = pd.Series(np.arange(1,2), index=rng)

print(ts)

#### Outputs ####
2018-01-01    1
2018-01-02    2
Freq: D, dtype: int32

2. å‡é‡‡æ ·å°±ä¸æ¶‰åŠåˆ°closedå’Œlabelçš„å€¼ï¼Œä¹Ÿå°±æ˜¯ä¼šå¿½ç•¥(ç­’å­ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹)ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™æ— éœ€è®¾ç½®è¿™ä¸¤ä¸ªå€¼ã€‚å¯¹äºå‡é‡‡æ ·ï¼Œå‰é¢ä¹Ÿæåˆ°ï¼Œä¸»è¦æ˜¯æ¶‰åŠåˆ°å€¼çš„å¡«å……ã€‚æœ‰ä¸‹é¢çš„å››ç§å¡«å……æ–¹æ³•ï¼ˆå®é™…æ˜¯ä¸‰ç§ï¼‰ï¼š

ä¸å¡«å……ã€‚é‚£ä¹ˆå¯¹åº”æ— å€¼çš„åœ°æ–¹ï¼Œç”¨NaNä»£æ›¿ã€‚å¯¹åº”çš„æ–¹æ³•æ˜¯asfreqã€‚
ç”¨å‰å€¼å¡«å……ã€‚ç”¨å‰é¢çš„å€¼å¡«å……æ— å€¼çš„åœ°æ–¹ã€‚å¯¹åº”çš„æ–¹æ³•æ˜¯ffillæˆ–è€…padã€‚è¿™é‡Œæ–¹ä¾¿è®°å¿†ï¼Œffillçš„ç¬¬ä¸€ä¸ªfæ˜¯ä»£è¡¨forwardï¼Œå‘å‰çš„æ„æ€
ç”¨åå€¼å¡«å……ã€‚å¯¹åº”çš„æ–¹æ³•æ˜¯bfillï¼Œbä»£è¡¨backã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š
ts_6h_asfreq = ts.resample('6H').asfreq()
print(ts_6h_asfreq)

#### Outputs ####
2018-01-01 00:00:00    1.0
2018-01-01 06:00:00    NaN
2018-01-01 12:00:00    NaN
2018-01-01 18:00:00    NaN
2018-01-02 00:00:00    2.0
Freq: 6H, dtype: float64



å°è¯•ï¼š
test= ts.asfreq(freq = '6H')
print(test)  å¯ä»¥è¾¾åˆ°ç›¸åŒæ•ˆæœï¼›

aa = test.asfreq(freq = '12H')
print(aa)  ----ç›´æ¥å°†ä¸ç¬¦åˆ12hé—´éš”çš„æ•°å»æ‰

#### Outputs ####
2018-01-01 00:00:00    1.0
2018-01-01 12:00:00    NaN
2018-01-02 00:00:00    2.0
Freq: 6H, dtype: float64

**************************************************
#HuangW.py


import pandas as pd
import numpy as np

def time_se_resample(setemp,freq,n_max=10,n_fill=1,fill_value=0,func='sum'):
    df_new=pd.DataFrame(setemp)
    df_new['deltT']=df_new.index.to_series().diff()    # numpy.diff() åŒåˆ—ä¸¤ä¸¤ç›¸å‡æˆ–ä¸åŒåˆ—ä¸¤ä¸¤ç›¸å‡ï¼Œå‚è§https://numpy.org/doc/stable/reference/generated/numpy.diff.html
    df_new['deltT'].fillna(pd.Timedelta(seconds=0),inplace=True)
    dT_group=df_new.groupby('deltT').size()   #æ ¹æ®æŒ‡å®šåˆ—çš„å€¼è¿›è¡Œåˆ†ç»„
    maxn_dt=dT_group[dT_group==dT_group.max()].index[0] #æ‰¾åˆ°åˆ†ç»„åå€¼æœ€å¤§çš„ï¼ˆå³size()æœ€å¤§ï¼‰
    df_mask=df_new['deltT']<maxn_dt*n_max
    df_mask=df_mask.astype('int8')
    if freq=='D' : deltT=24.0*3600.0
    if freq=='H' : deltT=3600.0
    if func=='sum':
        se_weighted=setemp*((df_new['deltT']/np.timedelta64(1,'s')).astype(int))*df_mask    #æ±‚å’Œï¼›functionå‚è€ƒreference
        se_result=se_weighted.resample(freq).sum()/deltT
    if func=='max':
        se_weighted=setemp*df_mask
        se_result=se_weighted.resample(freq).max()
    return(se_result)

#Referenceï¼š
>>> x = np.timedelta64(2069211000000000, 'ns')
>>> days = x.astype('timedelta64[D]')
>>> days / np.timedelta64(1, 'D')
23
